{"id":9232,"date":"2019-06-16T13:48:23","date_gmt":"2019-06-16T13:48:23","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=9232"},"modified":"2019-07-16T16:47:22","modified_gmt":"2019-07-16T16:47:22","slug":"some-notes-regarding-docker-kubernetes-azure-pipelines","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2019\/06\/16\/some-notes-regarding-docker-kubernetes-azure-pipelines\/","title":{"rendered":"Some notes regarding Docker, Kubernetes Azure Pipelines"},"content":{"rendered":"<h2>Docker Compose<\/h2>\n<p>&nbsp;<\/p>\n<p><strong>What is Docker Compose?<\/strong><\/p>\n<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YML file to configure your application\u2019s services. Then, with a single command, you create and start all the services from your configuration.<\/p>\n<ul>\n<li>In docker-compose.yml file, we will list all services (Web API, Frontend, DB, etc)<\/li>\n<li>Check the validity of yml file by running <em><strong>docker-compose config<\/strong><\/em> (path or\u00a0space if inside the path where the file is)<\/li>\n<li>Fix any issue in the docker-compose.yml file<\/li>\n<li>Run all services (containers) by running <em><strong>docker-compose up -d<\/strong><\/em><\/li>\n<li>Stop all services (containers) by running <em><strong>docker-compose down<\/strong><\/em><\/li>\n<\/ul>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<h3><strong>Install Docker compose<\/strong><\/h3>\n<pre class=\"lang:default decode:true\">sudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.24.0\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\r\n\r\nsudo chmod +x \/usr\/local\/bin\/docker-compose\r\n\r\n<\/pre>\n<p>&nbsp;<\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/2019\/06\/16\/some-notes-regarding-docker-kubernetes-azure-pipelines\/install-docker-compose-on-linux\/\" rel=\"attachment wp-att-9234\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-9234\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Install-Docker-Compose-on-Linux-1024x589.png\" alt=\"Install Docker Compose on Linux\" width=\"760\" height=\"437\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Install-Docker-Compose-on-Linux-1024x589.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Install-Docker-Compose-on-Linux-300x173.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Install-Docker-Compose-on-Linux-768x442.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Install-Docker-Compose-on-Linux.png 1118w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p>More info about <strong>docker compose<\/strong>:<\/p>\n<p><a href=\"https:\/\/docs.docker.com\/compose\/overview\/\">https:\/\/docs.docker.com\/compose\/overview\/<\/a><\/p>\n<p>&nbsp;<\/p>\n<h3><strong>How to build docker-compose.yml<\/strong><\/h3>\n<p><a href=\"https:\/\/docs.microsoft.com\/en-us\/dotnet\/standard\/microservices-architecture\/multi-container-microservice-net-applications\/multi-container-applications-docker-compose\">https:\/\/docs.microsoft.com\/en-us\/dotnet\/standard\/microservices-architecture\/multi-container-microservice-net-applications\/multi-container-applications-docker-compose<\/a><\/p>\n<p><a href=\"https:\/\/docs.docker.com\/compose\/compose-file\/\">https:\/\/docs.docker.com\/compose\/compose-file\/<\/a><\/p>\n<p>&nbsp;<\/p>\n<p class=\"blue\"><span class=\"ion-tip\">Tip (<strong><a href=\"https:\/\/mohamedradwan.com\/2019\/05\/31\/docker-for-beginners-step-by-step-tutorial\/\">Docker for beginners<\/a>)<\/strong><\/span> For more information about how to work with <strong>Docker<\/strong> like, pull docker image, run docker image and work with container, see <strong><a href=\"https:\/\/mohamedradwan.com\/2019\/05\/31\/docker-for-beginners-step-by-step-tutorial\/\"> Docker for beginners <\/a><\/strong><\/p>\n<p>&nbsp;<\/p>\n<h3>Docker multi-stage build and docker builder pattern<\/h3>\n<p>&nbsp;<\/p>\n<p><strong>Docker builder pattern<\/strong><\/p>\n<p>It involves two Docker images with two Dockerfiles. One for each image:<\/p>\n<ol>\n<li>&#8220;build&#8221; image with all the build tools installed, capable of creating production-ready application files. e.g an image with Installed-shield to create the package .<\/li>\n<li>\u00a0&#8220;service&#8221; image capable of running the application. e.g no need to have Installed-shield\u00a0as I don&#8217;t needed to run the application\u00a0.<\/li>\n<\/ol>\n<p><strong>Docker multi-stage build<\/strong><\/p>\n<p>Multi-stage builds are a new feature requiring Docker 17.05 or higher.\u00a0It helps to optimize Dockerfiles while keeping them easy to read and maintain. So, I can have multiple <strong>From<\/strong> in the same Dockerfile which means I can implement builder pattern without maintaining many Dockerfiles.<\/p>\n<p>&nbsp;<\/p>\n<p>We define each stage using <strong>As<\/strong> <strong>Stage Name<\/strong> in From statement. e.g<\/p>\n<ul>\n<li>From myImageName As build<\/li>\n<li>From myImageName AS test<\/li>\n<\/ul>\n<p>&nbsp;<\/p>\n<p>I can also use the stage as my base image instead of using image e.g:<\/p>\n<ul>\n<li>From myImageName As build<\/li>\n<li>From build As test<\/li>\n<\/ul>\n<p>&nbsp;<\/p>\n<p>So I create the stage for a purpose, for example to build the application, to unit test the application and then copy my application or test result (artifacts) to a mounted volume, then copy artifact\u00a0 from mounted volume to another stage if needed, it could be the final stage\u00a0to create the image that I will deploy the the prod.<\/p>\n<p>The main idea that I have a stage image that I don&#8217;t need it as a stored image, I just need to have it on the fly to produce some files and that&#8217;s it. Once I produce the file, I will take them and thanks!<\/p>\n<p>I only create and store images that I need them to be deployed to an environment<\/p>\n<p>&nbsp;<\/p>\n<h2><strong>Docker create<\/strong><\/h2>\n<p>The\u00a0<code class=\"highlighter-rouge\">docker create<\/code>\u00a0command creates a writeable container layer over the specified image and prepares it for running the specified command. The container ID is then printed to\u00a0<code class=\"highlighter-rouge\">STDOUT<\/code>. This is similar to\u00a0<code class=\"highlighter-rouge\">docker run -d<\/code>\u00a0except the container is never started. You can then use the\u00a0<code class=\"highlighter-rouge\">docker start &lt;container_id&gt;<\/code>\u00a0command to start the container at any point.<\/p>\n<p>This is useful when you want to set up a container configuration ahead of time so that it is ready to start when you need it. The initial status of the new container is\u00a0<code class=\"highlighter-rouge\">created<\/code>.<\/p>\n<p>&nbsp;<\/p>\n<p>More info about docker<strong> multi-stage build and docker create<\/strong><\/p>\n<p><a href=\"https:\/\/docs.docker.com\/develop\/develop-images\/multistage-build\/\">https:\/\/docs.docker.com\/develop\/develop-images\/multistage-build\/<\/a><\/p>\n<p><a href=\"https:\/\/docs.docker.com\/engine\/reference\/commandline\/create\/\">https:\/\/docs.docker.com\/engine\/reference\/commandline\/create\/<\/a><\/p>\n<p><a href=\"https:\/\/stackoverflow.com\/questions\/46705781\/extract-unit-test-results-from-multi-stage-docker-build-net-core-2-0\">https:\/\/stackoverflow.com\/questions\/46705781\/extract-unit-test-results-from-multi-stage-docker-build-net-core-2-0<\/a><\/p>\n<p>&nbsp;<\/p>\n<p class=\"blue\"><span class=\"ion-tip\">Tip (<strong><a href=\" https:\/\/mohamedradwan.com\/2019\/06\/08\/getting-started-with-kubernetes-cluster-ci-cd-for-azure-kubernetes-service\/ \"> Kubernetes cluster for beginner <\/a>)<\/strong><\/span> For more information about how to work with Kubernetes cluster and deploy it to <strong>Azure Kubernetes Service (AKS) <\/strong>and work with <strong>Azure Container Registry<\/strong>, see <strong><a href=\" https:\/\/mohamedradwan.com\/2019\/06\/08\/getting-started-with-kubernetes-cluster-ci-cd-for-azure-kubernetes-service\/ \">Kubernetes cluster for beginner<\/a><\/strong><\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<h3><strong>COPY vs. ADD in a Docker file<\/strong><\/h3>\n<p>Its means both Dockerfile command that serve similar purposes. Copy files from a specific location into a Docker image.<\/p>\n<p>COPY takes in a src and destination.<\/p>\n<p>It only lets you copy in a local file or directory from your host (the machine building the Docker image) into the Docker image itself.<\/p>\n<p>ADD lets you do that too, but it also supports 2 other sources. First, you can use a URL instead of a local file \/ directory. Secondly, you can extract a tar file from the source directly into the destination.<\/p>\n<p>&nbsp;<\/p>\n<h3>Copy Files Over SSH task (Azure Pipeline)<\/h3>\n<p>Use this task in a build or release pipeline to copy files from a source folder to a target folder on a remote machine over SSH.<\/p>\n<p><a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/deploy\/copy-files-over-ssh?view=azure-devops\">https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/deploy\/copy-files-over-ssh?view=azure-devops<\/a><\/p>\n<h3><\/h3>\n<h3>SSH\u00a0 task\u00a0\u00a0(Azure Pipeline)<\/h3>\n<p>Use this task in a build or release pipeline to run shell commands or a script on a remote machine using SSH. This task enables you to connect to a remote machine using SSH and run commands or a script.<\/p>\n<p><a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/deploy\/ssh?view=azure-devops\">https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/deploy\/ssh?view=azure-devops<\/a><\/p>\n<p>&nbsp;<\/p>\n<h3><\/h3>\n<h3>Shell task (Azure Pipelines)<\/h3>\n<p>Use this task in a build or release pipeline to run a shell script using bash.<\/p>\n<p><a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/utility\/shell-script?view=azure-devops\">https:\/\/docs.microsoft.com\/en-us\/azure\/devops\/pipelines\/tasks\/utility\/shell-script?view=azure-devops<\/a><\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/2019\/06\/16\/some-notes-regarding-docker-kubernetes-azure-pipelines\/azure-pipelines-shell-script-task-to-echo-agent_builddirectory\/\" rel=\"attachment wp-att-9243\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-9243\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Azure-Pipelines-Shell-Script-task-to-echo-AGENT_BUILDDIRECTORY-1024x790.png\" alt=\"Azure Pipelines Shell Script task to echo AGENT_BUILDDIRECTORY\" width=\"760\" height=\"586\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Azure-Pipelines-Shell-Script-task-to-echo-AGENT_BUILDDIRECTORY-1024x790.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Azure-Pipelines-Shell-Script-task-to-echo-AGENT_BUILDDIRECTORY-300x231.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Azure-Pipelines-Shell-Script-task-to-echo-AGENT_BUILDDIRECTORY-768x592.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/06\/Azure-Pipelines-Shell-Script-task-to-echo-AGENT_BUILDDIRECTORY.png 1478w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p>Links:<\/p>\n<p>Bash and PowerShell reference<\/p>\n<p>https:\/\/web1.cs.wright.edu\/~pmateti\/Courses\/233\/Labs\/Scripting\/bashVsPowerShellTable.html<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Docker Compose &nbsp; What is Docker Compose? Compose is a &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2019\/06\/16\/some-notes-regarding-docker-kubernetes-azure-pipelines\/\"> <span class=\"screen-reader-text\">Some notes regarding Docker, Kubernetes Azure Pipelines<\/span> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":9171,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,991,23,990],"tags":[963,994,917,1004,1005,1006],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9232"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=9232"}],"version-history":[{"count":5,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9232\/revisions"}],"predecessor-version":[{"id":9547,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9232\/revisions\/9547"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media\/9171"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=9232"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=9232"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=9232"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}