{"id":6251,"date":"2016-06-28T15:32:13","date_gmt":"2016-06-28T15:32:13","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=6251"},"modified":"2019-07-16T09:47:17","modified_gmt":"2019-07-16T09:47:17","slug":"microsoft-azure-scheduled-vm-shutdown-with-azure-automation","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2016\/06\/28\/microsoft-azure-scheduled-vm-shutdown-with-azure-automation\/","title":{"rendered":"Microsoft Azure \u2013 Scheduled VM Shutdown with Azure Automation"},"content":{"rendered":"<p><a href=\"#_Toc453834562\"><br \/>\nIntroduction<\/a><\/p>\n<p><a href=\"#_Toc453834563\">\u00a01: Create a new user in Active Directory<\/a><\/p>\n<p><a href=\"#_Toc453834564\">\u00a02: Specify a co-administrator for subscriptions<\/a><\/p>\n<p><a href=\"#_Toc453834565\">\u00a03: Add a New Automation Account<\/a><\/p>\n<p><a href=\"#_Toc453834566\">\u00a04: Create Credential Automation Asset<\/a><\/p>\n<p><a href=\"#_Toc453834567\">\u00a05: Create a Runbook<\/a><\/p>\n<p><a href=\"#_Toc453834568\">\u00a06: Add a Schedule for Runbook<\/a><\/p>\n<p><a href=\"#_Toc453834569\">\u00a07: Test and Publish the Runbook<\/a><\/p>\n<p><a href=\"#_Toc453834570\">\u00a08: Link the Runbook to an Existing Schedule<\/a><\/p>\n<p><a href=\"#_Toc453834571\">Conclusion<\/a><\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc453834562\"><\/a>Introduction<\/h2>\n<p>Running of <strong>Virtual Machines<\/strong> depends on computing hours or in another words it depends on how many hours <strong>Virtual Machines<\/strong> are running per day. \u00a0For example, if you are using <strong>Virtual Machines<\/strong> for West US region, with configuration that includes SSD drive, 2 cores, 7 GB RAM and 100 GB disk, it will cost you $208.32 per month. <strong>Microsoft Azure<\/strong> site also provides pricing calculator, which will show you the exact price and configuration of <strong>Azure<\/strong> features for your scenarios.<\/p>\n<p>Please visit <a href=\"https:\/\/azure.microsoft.com\/en-us\/pricing\/calculator\/\">https:\/\/azure.microsoft.com\/en-us\/pricing\/calculator\/<\/a> for more details. Using <strong>Virtual Machines<\/strong> with high configuration can be very expensive, but you can reduce the cost of <strong>Virtual Machines<\/strong> by reducing its working hours with <strong>Automated Shutdown<\/strong>.\u00a0 This post will describe how to create an <strong>Automated Shutdown<\/strong> of <strong>Virtual Machines<\/strong> on <strong>Windows Azure<\/strong>. You will see the step-by-step instructions and a detailed walkthrough of the process of creating <strong>Runbook<\/strong> and <strong>Schedule<\/strong> for <strong>Virtual Machines<\/strong> and how to link the <strong>Runbook<\/strong> to <strong>Schedule<\/strong> so that it get automatically stop at pre-defined times.<\/p>\n<p>&nbsp;<\/p>\n<p class=\"blue\"><span class=\"ion-tip\">Tip<\/span> If you would like to learn more about using the <a href=\"https:\/\/docs.microsoft.com\/en-us\/vsts\/build-release\/concepts\/definitions\/build\/variables?tabs=batch\">Build Variables<\/a> in <a href=\"https:\/\/www.visualstudio.com\/team-services\/\">VSTS<\/a> and Release Management, &#8211; have a look at the following post: <a href=\"https:\/\/mohamedradwan.com\/2018\/03\/11\/vsts-build-variables-and-echo\/\">VSTS Build variables and Echo<\/a>. The post describes how to see the output at any point of time. While automating a process, through setting variables and displaying them during the build.<\/p>\n<p>&nbsp;<\/p>\n<h3><a name=\"_Toc453834563\"><\/a>Step 1: Create a new user in Active Directory<\/h3>\n<p><strong>PowerShell script <\/strong>is Microsoft&#8217;s task-based command-line shell and scripting language designed especially for system administration. In order to run the <strong>PowerShell Script <\/strong>with<strong> Microsoft Azure<\/strong>, you will need to have a <strong>User<\/strong> linked to one of your<strong> Directories<\/strong>. If you don\u2019t have it, you will need to create one.<\/p>\n<ol>\n<li>Open the <strong>Microsoft Azure Portal<\/strong> and click on <strong>ACTIVE DIRECTORY <\/strong>from the navigation pane. <strong>Azure Active Directory<\/strong> is a comprehensive identity and access management cloud solution that provides a robust set of capabilities to manage users and groups.<\/li>\n<li>From the list of active directories, we will click on our directory. In our case it is <strong>Default Directory<\/strong>.<\/li>\n<li>Under <strong>default directory<\/strong>, click on <strong>USERS<\/strong>.<\/li>\n<li>From the command bar at the bottom of the Portal screen, click on <strong>ADD USER<\/strong>.<\/li>\n<\/ol>\n<p><a href=\"https:\/\/mohamedradwan.com\/?attachment_id=6253\" rel=\"attachment wp-att-6253\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-6253 size-large\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2016\/06\/1-1-Create-a-new-user-to-run-the-PowerShell-Script-with-Microsoft-Azure-1024x569.jpg\" alt=\"1-1 Create a new user to run the PowerShell Script with Microsoft Azure\" width=\"760\" height=\"422\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2016\/06\/1-1-Create-a-new-user-to-run-the-PowerShell-Script-with-Microsoft-Azure-1024x569.jpg 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2016\/06\/1-1-Create-a-new-user-to-run-the-PowerShell-Script-with-Microsoft-Azure-300x167.jpg 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2016\/06\/1-1-Create-a-new-user-to-run-the-PowerShell-Script-with-Microsoft-Azure-768x427.jpg 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2016\/06\/1-1-Create-a-new-user-to-run-the-PowerShell-Script-with-Microsoft-Azure.jpg 1092w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p class=\"gray\">You can see <strong><a href=\"https:\/\/www.youtube.com\/watch?v=rgf0IgktMQU&amp;t=2s\">this video<\/a><\/strong>, if you would like to find more information about step by step installation and configuring process of the TFS 2017 Update 1. See which deployment type to select, deployment scenario (Basic and Advanced). How to setup the Application Tier Web Services, Search configuration settings, Reporting Services settings. Also, do not forget to install and configure the Oracle component. See the overview of Team Foundation Server Administrator Console and how to create new Team project.<\/p>\n<p>&nbsp;<\/p>\n<p>5. A new window Tell us about this user will appear&#8230;&#8230;.<\/p>\n<h3><a href=\"http:\/\/www.testhouse.net\/microsoft-azure-scheduled-vm-shutdown-with-azure-automation\/\" target=\"_blank\" rel=\"noopener noreferrer\">Continue reading here&#8230;<\/a><\/h3>\n","protected":false},"excerpt":{"rendered":"<p>Introduction \u00a01: Create a new user in Active Directory \u00a02: &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2016\/06\/28\/microsoft-azure-scheduled-vm-shutdown-with-azure-automation\/\"> <span class=\"screen-reader-text\">Microsoft Azure \u2013 Scheduled VM Shutdown with Azure Automation<\/span> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,18],"tags":[99,839,844],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/6251"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=6251"}],"version-history":[{"count":5,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/6251\/revisions"}],"predecessor-version":[{"id":9534,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/6251\/revisions\/9534"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=6251"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=6251"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=6251"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}