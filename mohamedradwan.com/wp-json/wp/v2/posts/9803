{"id":9803,"date":"2019-12-05T23:58:44","date_gmt":"2019-12-05T23:58:44","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=9803"},"modified":"2020-01-13T04:51:20","modified_gmt":"2020-01-13T04:51:20","slug":"asp-net-core-tutorial-with-sql-sever-database-training-in-azure","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2019\/12\/05\/asp-net-core-tutorial-with-sql-sever-database-training-in-azure\/","title":{"rendered":"ASP.NET Core and SQL Server Database Training in Azure App Service"},"content":{"rendered":"<p>ASP.NET Core Tutorial Development with SQL Server Database Training in Azure App Service<\/p>\n<p>&nbsp;<\/p>\n<p><strong><b>\u00a0<\/b><\/strong><a href=\"#_Toc26481759\">Overview.of ASP.NET Core App with Entity Framework. <\/a><\/p>\n<p><a href=\"#_Toc26481760\">Create Client Machine. <\/a><\/p>\n<p><a href=\"#_Toc26481761\">Install all the prerequisite. <\/a><\/p>\n<p><a href=\"#_Toc26481762\">Clone the sample application locally from GitHub. <\/a><\/p>\n<p><a href=\"#_Toc26481763\">Create Azure SQL. <\/a><\/p>\n<p><a href=\"#_Toc26481764\">Create Azure Service Plan and Web App. <\/a><\/p>\n<p><a href=\"#_Toc26481765\">Set Azure App settings (Connection String and Env). <\/a><\/p>\n<p><a href=\"#_Toc26481766\">Push ASP.NET Core app to Azure. <\/a><\/p>\n<p>&nbsp;<\/p>\n<p>The following video has all the steps on how to do this tutorial<\/p>\n<p>&nbsp;<\/p>\n<div class=\"ast-oembed-container\" style=\"height: 100%;\"><iframe loading=\"lazy\" title=\"ASP.NET Core and SQL Database Training in Azure App Service | Developing ASP.NET &amp; Entity Framework\" width=\"500\" height=\"281\" src=\"https:\/\/www.youtube.com\/embed\/1QVRe7UHaro?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen><\/iframe><\/div>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc26481759\"><\/a>Overview<\/h2>\n<p>In this post, we will see how to build and deploy <a href=\"https:\/\/docs.microsoft.com\/en-us\/aspnet\/core\/?view=aspnetcore-3.1\" target=\"_blank\" rel=\"noopener noreferrer\">ASP.NET Core<\/a> application using |Entity Framework core with <a href=\"https:\/\/azure.microsoft.com\/en-gb\/services\/sql-database\/#:~:targetText=Azure%20SQL%20Database%20is%20the,mission%2Dcritical%20SQL%20Server%20workloads.\" target=\"_blank\" rel=\"noopener noreferrer\">SQL Server database on Azure<\/a> App Service.<\/p>\n<p>&nbsp;<\/p>\n<p>ASP.NET Core Tutorial\u00a0 And-Entity-Framework-With-Azure<\/p>\n<h2><a name=\"_Toc26481760\"><\/a>Create Client Machine<\/h2>\n<p>The first step is to create the first Resource Group. The <a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/azure-resource-manager\/resource-group-overview\" target=\"_blank\" rel=\"noopener noreferrer\">Resource Group<\/a> is a logical container in which Azure resources like Web App, VMs and Storage Account are deployed and managed. For example, you can choose to delete the entire Resource Group in one step later.<\/p>\n<p>&nbsp;<\/p>\n<p>So, the first Resource Group I will create the main virtual machine that I will be used in the demo so you can get better understanding of how to configure and prepare your client machine to run ASP.NET Core application.<\/p>\n<p>&nbsp;<\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/2019\/12\/05\/asp-net-core-and-sql-database-training-in-azure-app-service\/asp-net-and-entity-framework-with-azure\/\" rel=\"attachment wp-att-9805\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-9805\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/12\/ASP.NET-And-Entity-Framework-With-Azure.gif\" alt=\"ASP.NET-And-Entity-Framework-With-Azure\" width=\"762\" height=\"429\" \/><\/a><\/p>\n<h2><a name=\"_Toc26481761\"><\/a>Install all the prerequisite<\/h2>\n<p>I will install all the prerequisite, the first is Git then the .NET Core SDK and runtime, of course if you just run the application you just install the runtime but since we are going to developthe ASP.NET Core application as well then, we need the SDK.<\/p>\n<p>&nbsp;<\/p>\n<p>After that I will install the Visual Studio Code so I can edit and develop the application and then installing SQL Server Management Studio so I can connect later to the SQL Server on Azure.<\/p>\n<h2><a name=\"_Toc26481762\"><\/a>Clone the sample application locally from GitHub<\/h2>\n<p>After that, we will be using a sample application on GitHub, this sample application is a sample To-do list using ASP.NET core and Entity Framework core application with a basic CRUD (create read update delete). So, the first step is just to clone this repo from GitHub on my local VM once I did that, I will start restoring the package and building the application migrating the Entity Framework locally on the local database and then run the application<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p class=\"blue\"><span class=\"ion-tip\">Tip (<strong><a href=\" https:\/\/mohamedradwan.com\/2019\/06\/08\/getting-started-with-kubernetes-cluster-ci-cd-for-azure-kubernetes-service\/ \"> Kubernetes cluster for beginner <\/a>)<\/strong><\/span> For more information about how to work with Kubernetes cluster and deploy it to <strong>Azure Kubernetes Service (AKS) <\/strong>and work with <strong>Azure Container Registry<\/strong>, see <strong><a href=\" https:\/\/mohamedradwan.com\/2019\/06\/08\/getting-started-with-kubernetes-cluster-ci-cd-for-azure-kubernetes-service\/ \">Kubernetes cluster for beginner<\/a><\/strong><\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc20854032\"><\/a><\/h2>\n<h2><\/h2>\n<h2><a name=\"_Toc26481763\"><\/a>Create Azure SQL<\/h2>\n<p>After \u00a0that I will create the main resource \u00a0group that will have the rest of the \u00a0resources for our lab, the first \u00a0component is to create a logical SQL Server on Azure, I will use a username and \u00a0password which I will use them later for \u00a0configuring the connection string to connect to the database after that I \u00a0will create a firewall rules for SQL on Azure, this needed \u00a0in order to be able to connect to Azure SQL.<\/p>\n<p>&nbsp;<\/p>\n<p>After that I will create an Azure database, the database created will be in DTU model with s0 basic Tire. So, \u00a0the DTU model is a database transaction unit which works very well if you have a \u00a0pricing constraint and workload, it is also scalable if you want to upgrade that later in Azure database in the future however the DTU \u00a0model CPU capabilities and the storage \u00a0capabilities are closely coupled DT you are a mix of CPU\/IO and memory if you need more than you need to go for different model.<\/p>\n<p>&nbsp;<\/p>\n<p>After that I will create a deployment user which is just a username and passwords that I will use them later for pushing my application to the Azure App service using Git command.<\/p>\n<h2><a name=\"_Toc26481764\"><\/a>Create Azure Service Plan and Web App<\/h2>\n<p>After that I will create Azure service plan, think of it as the infrastructure for the Web App, I will create the service plan with the basic pricing tier in a Linux container.<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>After that I will create the Web App based on the created App service plan part of this creating is Git deployment enabled so I can push the application using Git command.<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc26481765\"><\/a>Set Azure App settings (Connection String and Env)<\/h2>\n<p>After that, I will set the connection string configuration in this Web App setting using the username and password I created with Azure SQL and use the name of the Azure SQL created then I will set the app settings configuration to be produced this will hide any error of Azure App Service to be displayed on the application.<\/p>\n<p>&nbsp;<\/p>\n<p>If I want to display the error in the Azure App service, I must change the app setting to be developed instead of production.<\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc26481766\"><\/a>Push ASP.NET Core app to Azure<\/h2>\n<p>In order to complete this ASP.NET Core Tutorial, I need to push my application Azure App service<\/p>\n<p>&nbsp;<\/p>\n<p>Once I pushed my application to the Azure App Service, this will run the Entity Framework migration which will create the database on SQL Server then I can access the application but in this time from the azure Web App<\/p>\n<p>&nbsp;<\/p>\n<p>For more info about the rest of the step, see all the video&#8230;&#8230;<\/p>\n<h3><strong>Commands <\/strong><\/h3>\n<p>Git<br \/>\ngit clone https:\/\/github.com\/azure-samples\/dotnetcore-sqldb-tutorial<br \/>\ncd dotnetcore-sqldb-tutorial<br \/>\ndotnet restore<br \/>\ndotnet ef database update<br \/>\ndotnet run<\/p>\n<p>&nbsp;<\/p>\n<p>Create a resource group<br \/>\naz group create &#8211;name RGLabRadwan &#8211;location &#8220;UK South&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p>SQL Logical server<br \/>\naz sql server create &#8211;name sqlservercoreappradwan &#8211;resource-group RGLabRadwan &#8211;location &#8220;UK South&#8221; &#8211;admin-user userradwan &#8211;admin-password DevOpsAKS@1234<\/p>\n<p>&nbsp;<\/p>\n<p>Firewall rule<br \/>\naz sql server firewall-rule create &#8211;resource-group RGLabRadwan &#8211;server sqlservercoreappradwan &#8211;name FWRuleAllowAzureRadwan &#8211;start-ip-address 0.0.0.0 &#8211;end-ip-address 0.0.0.0<\/p>\n<p>&nbsp;<\/p>\n<p>SQL DB<br \/>\naz sql db create &#8211;resource-group RGLabRadwan &#8211;server sqlservercoreappradwan &#8211;name SQLDBcoreDBRadwan &#8211;service-objective S0<\/p>\n<p>&nbsp;<\/p>\n<p>Deployment user<br \/>\naz webapp deployment user set &#8211;user-name userradwan &#8211;password DevOpsAKS@1234\/\/!<\/p>\n<p>&nbsp;<\/p>\n<p>App service plan<br \/>\naz appservice plan create &#8211;name appserviceplancoreappradwan &#8211;resource-group RGLabRadwan &#8211;sku B1 &#8211;is-linux<\/p>\n<p>&nbsp;<\/p>\n<p>Web app<br \/>\naz webapp create &#8211;resource-group RGLabRadwan &#8211;plan appserviceplancoreappradwan &#8211;name appserviceappcoreradwan &#8211;runtime &#8220;DOTNETCORE|2.2&#8243; &#8211;deployment-local-git<\/p>\n<p>&nbsp;<\/p>\n<p>Connection string<br \/>\nServer=tcp:sqlservercoreappradwan.database.windows.net,1433;Database=SQLDBcoreDBRadwan;User ID=userradwan;Password=DevOpsAKS@1234;Encrypt=true;Connection Timeout=30;<\/p>\n<p>&nbsp;<\/p>\n<p>Configure connection string<br \/>\naz webapp config connection-string set &#8211;resource-group RGLabRadwan &#8211;name appserviceappcoreradwan &#8211;settings MyDbConnection=&#8217;Server=tcp:sqlservercoreappradwan.database.windows.net,1433;Database=SQLDBcoreDBRadwan;User ID=userradwan;Password=DevOpsAKS@1234;Encrypt=true;Connection Timeout=30;&#8217; &#8211;connection-string-type SQLServer<\/p>\n<p>&nbsp;<\/p>\n<p>Env var<br \/>\naz webapp config appsettings set &#8211;name appserviceappcoreradwan &#8211;resource-group RGLabRadwan &#8211;settings ASPNETCORE_ENVIRONMENT=&#8221;Production&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p>git config &#8211;global user.email &#8220;mohamed@mohamedradwan.com&#8221;<br \/>\ngit config &#8211;global user.name &#8220;mradwan&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p>Add git remote<br \/>\ngit remote add azure https:\/\/userradwan@appserviceappcoreradwan.scm.azurewebsites.net\/appserviceappcoreradwan.git<\/p>\n<p>git push azure master<\/p>\n<p>&nbsp;<\/p>\n<p>diagnostic Log<br \/>\naz webapp log config &#8211;name appserviceappcoreradwan &#8211;resource-group RGLabRadwan &#8211;docker-container-logging filesystem<\/p>\n<p>az webapp log tail &#8211;name appserviceappcoreradwan &#8211;resource-group RGLabRadwan<\/p>\n<p>Delete RG<br \/>\naz group delete &#8211;name RGLabRadwan<\/p>\n<pre class=\"lang:default decode:true\"><\/pre>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>ASP.NET Core Tutorial Development with SQL Server Database Training in &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2019\/12\/05\/asp-net-core-tutorial-with-sql-sever-database-training-in-azure\/\"> <span class=\"screen-reader-text\">ASP.NET Core and SQL Server Database Training in Azure App Service<\/span> Read More<\/a><\/p>\n","protected":false},"author":2,"featured_media":9807,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,18],"tags":[1016,1011,99,1014,1013,1015,1012],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9803"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=9803"}],"version-history":[{"count":5,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9803\/revisions"}],"predecessor-version":[{"id":9867,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/9803\/revisions\/9867"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media\/9807"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=9803"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=9803"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=9803"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}