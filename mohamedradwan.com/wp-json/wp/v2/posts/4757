{"id":4757,"date":"2014-11-06T15:05:05","date_gmt":"2014-11-06T15:05:05","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=4757"},"modified":"2016-06-15T07:08:53","modified_gmt":"2016-06-15T07:08:53","slug":"deploying-ssdt-during-local-and-server-build","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2014\/11\/06\/deploying-ssdt-during-local-and-server-build\/","title":{"rendered":"Deploying SSDT During Local and Server Build"},"content":{"rendered":"<p><span style=\"color: #0000ff;\">Updated on 26\/1\/2015<\/span><br \/>\n<span style=\"color: #0000ff;\">=======================================<\/span><br \/>\n4 years ago, I wrote a post about\u00a0<a title=\" NOVEMBER 13, 2010 BY MOHAMED RADWAN (MVP) Automate the best practice for check-in, including Get latest, deploy DB, Run test, check-in\" href=\"https:\/\/mohamedradwan.com\/2010\/11\/13\/automate-the-best-practice-for-check-in-including-get-latest-deploy-db-run-test-check-in\/\" target=\"_blank\">how to deploy VS DB (Visual Studio Database Project) to your local SQL Server during your local <\/a>build.<\/p>\n<p>As you may already know that a new version of <a title=\"Sql Server Data Tool\" href=\"http:\/\/msdn.microsoft.com\/da-dk\/data\/tools.aspx\" target=\"_blank\">SSDT (SQL Server Data Tool)<\/a> has been released with VS 2012 to replace the normal VS DB project that was existing with VS 2010 and of course the deployment\u00a0changed.<\/p>\n<p>For more information and understadning about SSDT, see this post:<br \/>\n<a title=\"What\u2019s New in TFS 2012?- SSDT (SQL Server Data Tool)\" href=\"https:\/\/mohamedradwan.com\/2012\/08\/02\/whats-new-in-tfs-2012-ssdt-sql-server-developer-tool\/\" target=\"_blank\">What\u2019s New in TFS 2012?- SSDT (SQL Server Data Tool)<\/a><\/p>\n<p>Now we have a feature called publish profile which you can put all your setting in that file and use it afterwards to deploy the DB.<\/p>\n<p>This post has 2 section:<\/p>\n<ul>\n<li>Deploy and publish SSDT to local SQL Server during local build<\/li>\n<li>Deploy and publish SSDT to a shared SQL Server during TFS Build<\/li>\n<\/ul>\n<h2><span style=\"color: #339966;\">Deploy and publish SSDT to local SQL Server during local build<\/span><\/h2>\n<p>If \u00a0you need to work with SSDT for SQL Server 2014, then you will need to install the last SSDT, it&#8217;s not included in VS update 3, <a href=\"http:\/\/blogs.msdn.com\/b\/ssdt\/archive\/2014\/07\/24\/creating-an-administrative-install-of-ssdt-update-for-visual-studio-2013.aspx\" target=\"_blank\">download SSDT<\/a><br \/>\n<a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4759\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014.jpg\" alt=\"SSDT for SQL Server 2014\" width=\"660\" height=\"316\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014.jpg 1262w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014-300x144-1.jpg 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014-768x368-1.jpg 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-for-sql-server-2014-1024x491-1.jpg 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p><strong>1.Using\u00a0<a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/microsoft.data.tools.schema.tasks.sql.sqlpublishtask(v=vs.103).aspx\" target=\"_blank\">SqlPublishTask <\/a>of MSBuild<\/strong><br \/>\nI edit the SSDT project file as the following:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4760\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt.png\" alt=\"local publish SSDT\" width=\"660\" height=\"47\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt.png 1231w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt-300x22.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt-768x56.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/local-publish-ssdt-1024x74.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>[code language=&#8221;xml&#8221;]<\/p>\n<p>&lt;Target Name=&#8221;DeployDB&#8221; AfterTargets=&#8221;build&#8221; Condition=&#8221;&#8216;$(Configuration)&#8217; == &#8216;Local'&#8221;&gt;<br \/>\n&lt;Message Importance=&#8221;high&#8221; Text=&#8221;************** Star Deploying DB **************&#8221; \/&gt;<br \/>\n&lt;Message Importance=&#8221;high&#8221; Text=&#8221;Deploying Project: $(MSBuildProjectDirectory)$(MSBuildProjectName).sqlproj&#8221; \/&gt;<br \/>\n&lt;Message Importance=&#8221;high&#8221; Text=&#8221;Deployment Profile: $(MSBuildProjectDirectory)PublishProfiles$(MSBuildProjectName).local.publish.xml&#8221; \/&gt;<br \/>\n&lt;MSBuild Projects=&#8221;$(MSBuildProjectDirectory)$(MSBuildProjectName).sqlproj&#8221; Properties=&#8221;SqlPublishProfilePath=$(MSBuildProjectDirectory)PublishProfiles$(MSBuildProjectName).local.publish.xml&#8221; Targets=&#8221;sqlPublish&#8221; \/&gt;<br \/>\n&lt;\/Target&gt;<br \/>\n[\/code]<\/p>\n<p>I used some of <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/ms164309.aspx\" target=\"_blank\">MSBuild Reserved and Well-Known Properties<\/a>\u00a0like $(MSBuildProjectName) and $(MSBuildProjectDirectory), for complete list, <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/ms164309.aspx\" target=\"_blank\">click on this link<\/a><\/p>\n<p>====================================================================================<\/p>\n<p><strong>2.Using MS Build Command line with <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/microsoft.data.tools.schema.tasks.sql.sqlpublishtask(v=vs.103).aspx\" target=\"_blank\">SqlPublishTask<\/a><\/strong><\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4763\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line.png\" alt=\"MSBuild SqlPublishTask command line\" width=\"660\" height=\"223\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line.png 1366w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line-300x101.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line-768x260.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/msbuild-sqlpublishtask-command-line-1024x346.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>[code language=&#8221;xml&#8221;]<br \/>\nmsbuild \/t:build;publish &#8220;C:TFS SourceModelCalculatorCalculator.DBCalculator.DB.sqlproj&#8221; \/p:SqlPublishProfilePath=&#8221;C:TFS SourceModelCalculatorCalculator.DBPublishProfilesCalculator.DB.local.publish.xml&#8221;<\/p>\n<p>&#8220;$(MSBuildProgramFiles32)MSBuild12.0Binmsbuild&#8221; \/t:build;publish &#8220;C:TFS SourceModelCalculatorCalculator.DBCalculator.DB.sqlproj&#8221; \/p:SqlPublishProfilePath=&#8221;C:TFS SourceModelCalculatorCalculator.DBPublishProfilesCalculator.DB.local.publish.xml&#8221;<br \/>\n[\/code]<\/p>\n<ul>\n<li>If we run the MS Build from withing the project path we can use relative paths instead of\u00a0absolute paths<\/li>\n<li>To use MSBuild without path, we need to open Visual Studio command line otherwise we may having this error &#8220;<span style=\"color: #ff0000;\">exited with code 9009<\/span>\u201d which means it couldn&#8217;t find the MSBuild.exe&#8221;, so I will\u00a0need to use the full path and this is always the case when working with pre\u00a0and post\u00a0build events<\/li>\n<\/ul>\n<p>====================================================================================<\/p>\n<p><strong>3.Using\u00a0<a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/hh550080%28v=VS.103%29.aspx\" target=\"_blank\">SqlPackage.exe<\/a><\/strong><\/p>\n<p>SqlPackage.exe is a command line utility that automate some of the DB development tasks<\/p>\n<p>We can call SqlPackage as a post build event for SSDT project as the following:<\/p>\n<p>[code language=&#8221;xml&#8221;]<br \/>\n&#8220;$(MSBuildProgramFiles32)Microsoft SQL Server110DACbinsqlpackage&#8221; \/a:publish \/sf:&#8221;$(SolutionDir)$(ProjectName)$(OutputPath)Calculator.DB.dacpac&#8221; \/pr:&#8221;$(SolutionDir)$(ProjectName)Calculator.DB.local.publish.xml&#8221;<br \/>\n[\/code]<\/p>\n<p>The .dacpac file is the output of building sqlproject, as\u00a0the dll is the output of building a class library<br \/>\n====================================================================================<\/p>\n<h2><span style=\"color: #339966;\">Deploy and publish SSDT to a shared SQL Server during TFS Build<\/span><\/h2>\n<p>There are many ways too, the SSDT&#8217;s team blog create a great post for all ways, for more info, click on the following link:<br \/>\n<a title=\"SQL Server Database Projects and Team Foundation Build\" href=\"http:\/\/blogs.msdn.com\/b\/ssdt\/archive\/2014\/07\/24\/sql-server-database-projects-and-team-foundation-build.aspx#publishDb\" target=\"_blank\">SQL Server Database Projects and Team Foundation Build<\/a><\/p>\n<p><strong>1.Using\u00a0<a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/microsoft.data.tools.schema.tasks.sql.sqlpublishtask(v=vs.103).aspx\" target=\"_blank\">SqlPublishTask <\/a>of MSBuild<\/strong><br \/>\nI will send some MDBuild arguments in the build definition\u00a0as the following:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4773\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1.png\" alt=\"TFSBuild-SSDT1\" width=\"660\" height=\"304\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1.png 1146w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1-300x138.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1-768x355.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/tfsbuild-ssdt1-1024x473.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>[code language=&#8221;xml&#8221;]<br \/>\n\/t:Build;Publish \/p:SqlPublishProfilePath=..\/Calculator.DBPublishProfilesCalculator.DB.local.publish.xml<br \/>\n[\/code]<\/p>\n<p>But because my solution has many projects not only SSDT project, which means I build the solution file not the SSDT project file only, this means, the build argument will be sent to each project file in the solution and this gives error with one\u00a0of the Win Form project as the following:<\/p>\n<p><span style=\"color: #ff0000;\">MSBuild error MSB3021: Unable to copy file\u00a0<\/span><span style=\"color: #ff0000;\">C:Program Files (x86)MSBuild12.0binamd64Microsoft.Common.CurrentVersion.targets (4691): Could not copy the file &#8220;exe.manifest&#8221; because it was not found.<\/span><\/p>\n<p>This error will disappear if we only build SSDT, of course I can use other ways like using SqlPackage.exe with custom build but as this is the way I did on my local build, I prefered to be the same on the Build server, so I customize the build as the following<\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild.png\"><br \/>\n<img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4774\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild.png\" alt=\"SSDT with TFSBuild\" width=\"660\" height=\"279\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild.png 1203w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild-300x127.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild-768x326.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2014\/11\/ssdt-with-tfsbuild-1024x434.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>I used 2 editors:<\/p>\n<ul>\n<li>Microsoft.TeamFoundation.Build.Controls.BuildProjectListEditor<\/li>\n<li>Microsoft.TeamFoundation.Build.Controls.StringListEditor<\/li>\n<\/ul>\n<p>Which makes me be able to select multiple build project and multiple publish profiles, for more info about Build Editors, see the following post:<br \/>\n<a title=\"TFS Build Editors and Build Process Metadata\" href=\"https:\/\/mohamedradwan.com\/2014\/08\/15\/tfs-build-editors-and-build-process-metadata\/\" target=\"_blank\">TFS Build Editors and Build Process Metadata<\/a><\/p>\n<p><span style=\"color: #0000ff;\">Beginning of the update<br \/>\n&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-<\/span><\/p>\n<p>To customize the process I added 2\u00a0arguments and I added them to the meatadata to categorize\u00a0them under SSDT section in the Build definition<\/p>\n<p><a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4811\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section.png\" alt=\"SSDT Section\" width=\"660\" height=\"373\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section.png 1242w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/ssdt-section-1024x578.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>I used MSBuild activity to run MSBuild for the SSDT projects that selected by the build definition<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4810\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt.png\" alt=\"Run MSBuild for SSDT\" width=\"660\" height=\"333\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt.png 1238w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt-300x151.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt-768x387.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/run-msbuild-for-ssdt-1024x516.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>You can download the process template by click on the following link:<br \/>\n<a title=\"Download process template\" href=\"https:\/\/onedrive.live.com\/redir?resid=4BCAA16D27B46600%2122421\" target=\"_blank\">TFS Process Template<\/a><\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Updated on 26\/1\/2015 ======================================= 4 years ago, I wrote a &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2014\/11\/06\/deploying-ssdt-during-local-and-server-build\/\"> <span class=\"screen-reader-text\">Deploying SSDT During Local and Server Build<\/span> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":5515,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[17,43],"tags":[516],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4757"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=4757"}],"version-history":[{"count":4,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4757\/revisions"}],"predecessor-version":[{"id":6131,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4757\/revisions\/6131"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media\/5515"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=4757"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=4757"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=4757"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}