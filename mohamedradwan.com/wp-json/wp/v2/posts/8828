{"id":8828,"date":"2019-01-14T02:11:37","date_gmt":"2019-01-14T02:11:37","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=8828"},"modified":"2019-07-10T16:09:31","modified_gmt":"2019-07-10T16:09:31","slug":"whats-new-for-developers-in-azure-cosmos-db","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2019\/01\/14\/whats-new-for-developers-in-azure-cosmos-db\/","title":{"rendered":"What\u2019s new for developers in Azure Cosmos DB"},"content":{"rendered":"<p><a href=\"#_Toc500069570\">Introduction<\/a><br \/>\n<a href=\"#_Toc500069571\">Developer update highlights<\/a><br \/>\n<a href=\"#_Toc500069572\">.NET SDK Version 3.0 (preview)<\/a><br \/>\n<a href=\"#_Toc500069573\">Database-level throughput \u2013 25x lower entry point<\/a><br \/>\n<a href=\"#_Toc500069574\">Azure Pipelines Cosmos DB Emulator build tasks <\/a><br \/>\n<a href=\"#_Toc500069575\">A real example<\/a><br \/>\n<a href=\"#_Toc500069576\">Conclusion<\/a><\/p>\n<h2><a name=\"_Toc500069570\"><\/a>Introduction<\/h2>\n<p>For those of you that are new to the service, <a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/cosmos-db\/introduction\" target=\"_blank\" rel=\"noopener noreferrer\">Cosmos DB<\/a> is a global distributed multi model database service, that allows you to read and write data from any Azure region with single-digit millisecond latency for both reads and writes,<\/p>\n<h2><a name=\"_Toc500069571\"><\/a>Developer update highlights<\/h2>\n<h3><a name=\"_Toc500069572\"><\/a>.NET SDK Version 3.0 (preview)<\/h3>\n<p><a href=\"http:\/\/Azure Cosmos DB .NET SDK Version 3.0 now in public preview\" target=\"_blank\" rel=\"noopener noreferrer\">.NET SDK Version 3.0<\/a> targets .It has a new intuitive object model designed to be easier to use, support for streams and performance improvements, and also it is open source on github.<\/p>\n<p>&nbsp;<\/p>\n<h3><a name=\"_Toc500069573\"><\/a>Database-level throughput \u2013 25x lower entry point<\/h3>\n<p>This will enable you to make a new database, put as many containers as you want inside and have them all share the same throughput of the database.<\/p>\n<p>&nbsp;<\/p>\n<h3><a name=\"_Toc500069574\"><\/a> Azure Pipelines Cosmos DB Emulator build tasks<\/h3>\n<p><a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/cosmos-db\/tutorial-setup-ci-cd\" target=\"_blank\" rel=\"noopener noreferrer\">Azure Pipelines Comos Db build task <\/a>allows you to run tests against cosmos DB emulator in your CI CD pipelines.<\/p>\n<p>&nbsp;<\/p>\n<p class=\"green\"><span class=\"ion-info\">More Info<\/span>If you would like to know more about Azure deployments, have a look at the post <a href=\"https:\/\/mohamedradwan.com\/2018\/02\/12\/how-to-deploy-to-azure-using-team-services-release-management\/\">How to deploy to Azure using Team Services Release Management<\/a>. The post describes how Azure deployments are made easy by using Visual Studio Team Services (VSTS) Release Management. You will see a step-by-step tutorial on how to configure and deploy to Azure in Release Management, and, moreover, how to configure an end-to-end pipeline for deploying applications on Azure.<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc500069575\"><\/a>A real example<\/h2>\n<p>Let\u2019s see an example. Now I am going to create a new database with Cosmos DB in just one line (image 1). I will start with this.database equals to this.cosmosClient which is the entry point to interact with a cosmos DB service. Off this cosmos client we see that there is a new databases property off which we can access every method relevant to databases. In this case I\u2019ll use the CreateDatabaseIfNotExistsAsync method, giving the databaseId. I\u2019ll put a wait in front of it, and now I\u2019ve created a new database in just one line with cosmos DB.<\/p>\n<figure id=\"attachment_8832\" aria-describedby=\"caption-attachment-8832\" style=\"width: 760px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"size-large wp-image-8832\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-1-Create-a-new-database-in-just-one-line-with-Cosmos-DB-1024x578.png\" alt=\"Image 1 - Create a new database in just one line with Cosmos DB\" width=\"760\" height=\"429\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-1-Create-a-new-database-in-just-one-line-with-Cosmos-DB-1024x578.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-1-Create-a-new-database-in-just-one-line-with-Cosmos-DB-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-1-Create-a-new-database-in-just-one-line-with-Cosmos-DB-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-1-Create-a-new-database-in-just-one-line-with-Cosmos-DB.png 1372w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><figcaption id=\"caption-attachment-8832\" class=\"wp-caption-text\">Image 1 &#8211; Create a new database in just one line with Cosmos DB<\/figcaption><\/figure>\n<p>&nbsp;<\/p>\n<p>With the new SDK the object model is updated and also API surface is updated to be more modular. Now as a result we have a database object, a containers object and items, each with their own relevant methods. After we run the code, the resources in cosmos DB (database container and item) will be actually created. If we check in the portal.<\/p>\n<p>Navigate to data Explorer that is the one-stop shop for viewing all the data and the cosmos DB containers. After refreshing, we can see that our \u201cto do\u201d database and \u201cto do\u201d container have both been created. If we open the \u201cDocuments\u201d we can see that it is the same item which we created via console app (image 2).<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<figure id=\"attachment_8833\" aria-describedby=\"caption-attachment-8833\" style=\"width: 760px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"size-large wp-image-8833\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-2-Data-explorer-1024x578.png\" alt=\"Image 2 - Data explorer\" width=\"760\" height=\"429\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-2-Data-explorer-1024x578.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-2-Data-explorer-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-2-Data-explorer-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-2-Data-explorer.png 1372w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><figcaption id=\"caption-attachment-8833\" class=\"wp-caption-text\">Image 2 &#8211; Data explorer<\/figcaption><\/figure>\n<p>&nbsp;<\/p>\n<h3 class=\"gray\">You can see <strong><a href=\"https:\/\/www.youtube.com\/watch?v=vev3Czaa1pA\">this video\u00a0<\/a><\/strong><\/h3>\n<p class=\"gray\">if you would like to find more information about a walkthrough introducing the Release Management and Build Automation using TFS 2017\/2015. Step by step about all process, starting from creating the project, check in the code in the source control, create a build definition and trigger the build, and also create a release pipeline.<\/p>\n<p class=\"gray\">Learn how to configure properly the build steps, including Copy Files and Publish Build Artifacts. See how to create new release definition, add environments and link to build definition. Afterwards see how to add tasks to the release definition, like Windows Machine File Copy and configure it properly.If we take a closer look at our \u201cto do\u201d container, if we go to \u201cScale &amp; Settings\u201d, we can see more information about Scale and Conflict resolution (image 3).<\/p>\n<p>&nbsp;<\/p>\n<figure id=\"attachment_8834\" aria-describedby=\"caption-attachment-8834\" style=\"width: 760px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"size-large wp-image-8834\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-3-Scale-Settings-1024x578.png\" alt=\"Image 3 - Scale &amp; Settings\" width=\"760\" height=\"429\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-3-Scale-Settings-1024x578.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-3-Scale-Settings-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-3-Scale-Settings-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-3-Scale-Settings.png 1372w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><figcaption id=\"caption-attachment-8834\" class=\"wp-caption-text\">Image 3 &#8211; Scale &amp; Settings<\/figcaption><\/figure>\n<p>Next, we will see a dev-test experience with a asp.net web application running again <a href=\"https:\/\/docs.microsoft.com\/en-us\/azure\/cosmos-db\/\" target=\"_blank\" rel=\"noopener noreferrer\">Cosmos DB<\/a>. Actually, it is running against our local emulator. The emulator runs on Windows machines and allows you to emulate the Cosmos DB service locally.<\/p>\n<p>So you can do operations like creating databases and containers. Running unit tests etc without incurring any cost on the Cosmos DB service. Now I will run my already created unit tests. which will create a new container, create a new database, add some items to it.Ttest a query, running against a local version of the emulator.<\/p>\n<h2><\/h2>\n<h2>CI\/CD pipeline :<\/h2>\n<p>Now also you can do the same thing in CI\/CD pipeline. I have already a pipeline setup, which builds my web app.Run some tests, and deploys it to azure app service. I just need to add my Cosmos DB emulator build task (image 4), which I can get it free from the Azure devops marketplace. There I should just specify that I want to use the endpoint emitted by the emulator container earlier in this pipeline.<\/p>\n<p>&nbsp;<\/p>\n<figure id=\"attachment_8835\" aria-describedby=\"caption-attachment-8835\" style=\"width: 760px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"size-large wp-image-8835\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-4-Run-Azure-Cosmos-DB-Emulator-container-1024x578.png\" alt=\"Image 4 - Run Azure Cosmos DB Emulator container\" width=\"760\" height=\"429\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-4-Run-Azure-Cosmos-DB-Emulator-container-1024x578.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-4-Run-Azure-Cosmos-DB-Emulator-container-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-4-Run-Azure-Cosmos-DB-Emulator-container-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-4-Run-Azure-Cosmos-DB-Emulator-container.png 1372w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><figcaption id=\"caption-attachment-8835\" class=\"wp-caption-text\">Image 4 &#8211; Run Azure Cosmos DB Emulator container<\/figcaption><\/figure>\n<p>After that, I can queue my build. On the image 5 you can see the log details.<\/p>\n<p>&nbsp;<\/p>\n<figure id=\"attachment_8836\" aria-describedby=\"caption-attachment-8836\" style=\"width: 760px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"size-large wp-image-8836\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-5-Detailed-logs-of-the-Azure-Cosmos-Emulator-DB-container-1024x578.png\" alt=\"Image 5 - Detailed logs of the Azure Cosmos Emulator DB container\" width=\"760\" height=\"429\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-5-Detailed-logs-of-the-Azure-Cosmos-Emulator-DB-container-1024x578.png 1024w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-5-Detailed-logs-of-the-Azure-Cosmos-Emulator-DB-container-300x169.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-5-Detailed-logs-of-the-Azure-Cosmos-Emulator-DB-container-768x433.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2019\/01\/Image-5-Detailed-logs-of-the-Azure-Cosmos-Emulator-DB-container.png 1372w\" sizes=\"(max-width: 760px) 100vw, 760px\" \/><figcaption id=\"caption-attachment-8836\" class=\"wp-caption-text\">Image 5 &#8211; Detailed logs of the Azure Cosmos Emulator DB container<\/figcaption><\/figure>\n<p>This build task makes it a lot easier to use the Cosmos DB in CI\/CD, meaning, you no longer need to deal with manually setting up a container and manually setting the emulator and getting it to run.<\/p>\n<p>&nbsp;<\/p>\n<h2><a name=\"_Toc500069576\"><\/a>Conclusion<\/h2>\n<p>Azure Cosmos DB is Microsoft&#8217;s globally distributed multi-model database service. With the click of a button. Azure Cosmos DB enables you to elastically and independently scale throughput and storage across any number of Azure&#8217;s geographic regions. You can elastically scale throughput and storage. And take advantage of fast, single-digit-millisecond data access using your favorite API among SQL, MongoDB, Cassandra, Tables, or Gremlin. You can try Azure Cosmos DB for Free without an Azure subscription, free of charge and commitments. Try all the above mentioned and stay up-to-date on the latest Azure CosmosDB news and features.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Introduction Developer update highlights .NET SDK Version 3.0 (preview) Database-level &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2019\/01\/14\/whats-new-for-developers-in-azure-cosmos-db\/\"> <span class=\"screen-reader-text\">What\u2019s new for developers in Azure Cosmos DB<\/span> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":9143,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,18],"tags":[99,945],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/8828"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=8828"}],"version-history":[{"count":6,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/8828\/revisions"}],"predecessor-version":[{"id":9451,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/8828\/revisions\/9451"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media\/9143"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=8828"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=8828"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=8828"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}