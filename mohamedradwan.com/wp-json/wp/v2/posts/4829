{"id":4829,"date":"2015-01-27T14:44:25","date_gmt":"2015-01-27T14:44:25","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=4829"},"modified":"2019-03-18T10:46:07","modified_gmt":"2019-03-18T10:46:07","slug":"versioning-assembly-during-tfs-build-2013","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/","title":{"rendered":"Versioning Assembly during TFS Build 2013"},"content":{"rendered":"<p>My fellows MVPs\u00a0<a href=\"http:\/\/www.colinsalmcorner.com\/about\" target=\"_blank\">Colin Dembovsky<\/a> and <a href=\"http:\/\/www.codewrecks.com\/blog\/\" target=\"_blank\">Ricci Gian Maria<\/a> had great posts on doing Assembly Versioning, it doesn&#8217;t cover my case but they helped me very well. Thanks guys \ud83d\ude42<\/p>\n<p>First, It&#8217;s better to understanding the Assembly version.<\/p>\n<p>Assembly versions consist of four different parts ({<strong>Major<\/strong> Version}.{<strong>Minor<\/strong> Version}.{<strong>Build<\/strong> Number}.{<strong>Revision<\/strong> Source Control Revision})<\/p>\n<p><strong>Major<\/strong>.<strong>Minor<\/strong>.<strong>Build<\/strong>.<strong>Revision<\/strong><\/p>\n<p><strong>Major<\/strong>: The main version of the product. For example the Major of all the VisualStudio 2012 assemblies are 11 and VisualStudio 2013 are\u00a012.<\/p>\n<p><strong>Minor<\/strong>: Small changes that doesn&#8217;t required changing in Application interfaces, so it will not break other application it depends on. This number will be reset to zero when the Major number changes.<\/p>\n<p><strong>Build<\/strong>: Using this number you can find the build on the build server.<\/p>\n<p><strong>Revision<\/strong>: This is the number from source control for\u00a0that build number.<\/p>\n<p>See the following image:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/vs-version\/#main\" rel=\"attachment wp-att-4833\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4833\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/vs-version.png?w=660\" alt=\"VS Version\" width=\"660\" height=\"445\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/vs-version.png 815w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/vs-version-300x202.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/vs-version-768x518.png 768w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p><strong><span style=\"color: #008000;\">We can see in the previous image that the Version\u00a0is different from the File Version? so why this happen?<\/span><\/strong><\/p>\n<p>To answer this question we need to know that you don&#8217;t have to do that,\u00a0but as the Version is the version that .NET uses when linking assemblies, so you might want to keep the Version without\u00a0the build number and the revision as you may want to change something, it might be\u00a0only changing in the build parameters and you don&#8217;t want to\u00a0rebuild all dependent assemblies.<\/p>\n<p><span style=\"color: #008000;\"><br \/>\n<strong>Using one AssemblyInfo.cs for all projects within\u00a0the same solution<\/strong><\/span><\/p>\n<p>We might want to use\u00a0one file to maintain the Version and the File version for all projects as the following:<\/p>\n<ul>\n<li>Create AssemblyInfo.cs as a solution file, it will include AssemblyVersion and AssemblyFileVersion attributes<\/li>\n<li>Add an exiting item for all your projects as a linked item to point to that file<\/li>\n<li>Remove the AssemblyVersion and AssemblyFileVersion attributes from all the project AssemblyInfo.cs files.<\/li>\n<\/ul>\n<p><a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/add-exiting-item-as-link\/#main\" rel=\"attachment wp-att-4837\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4837\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/add-exiting-item-as-link.png?w=660\" alt=\"Add exiting item as link\" width=\"660\" height=\"402\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/add-exiting-item-as-link.png 961w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/add-exiting-item-as-link-300x183.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/add-exiting-item-as-link-768x468.png 768w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p><strong><span style=\"color: #008000;\">Versioning Assembly during TFS Build<\/span><\/strong><\/p>\n<p>The idea hear is to change the number in the AssemblyInfo.cs during the build and before the compiling happen.<\/p>\n<p>In my case I use a PowerShell script and I customize my process as the following:<\/p>\n<p>&nbsp;<\/p>\n<pre class=\"lang:default decode:true\">Param(\r\n\r\n[string]$pathToSearch,\r\n[string]$buildNumIncludeBuildDefination,\r\n[string]$extractedBuildNum,\r\n[string]$chagesetWithC,\r\n[string]$chageset,\r\n[string]$searchFilter = \"AssemblyInfo*.*\",\r\n[string]$assemblyVersion,\r\n[string]$fileAssemblyVersion\r\n\r\n)\r\n\r\ntry\r\n{\r\n\r\n$extractedBuildNum = $buildNumIncludeBuildDefination.substring($buildNumIncludeBuildDefination.LastIndexOf(\".\")+1 ,(($buildNumIncludeBuildDefination.length)- ($buildNumIncludeBuildDefination.LastIndexOf(\".\"))-1))\r\n$chageset = $chagesetWithC.substring($chagesetWithC.LastIndexOf(\"C\")+1 ,(($chagesetWithC.length)- ($chagesetWithC.LastIndexOf(\"C\"))-1))\r\n\r\n$assemblyVersion = $assemblyVersion.Replace(\"B\", $extractedBuildNum).Replace(\"R\", $chageset)\r\n$fileAssemblyVersion = $fileAssemblyVersion.Replace(\"B\", $extractedBuildNum).Replace(\"R\", $chageset)\r\n\r\ngci -Path $pathToSearch -Filter $searchFilter -Recurse | %{\r\nWrite-Host \" -&gt; Changing $($_.FullName)\"\r\n\r\n# remove the read-only bit on the file\r\nsp $_.FullName IsReadOnly $false\r\n\r\n# run the regex replace\r\n(gc $_.FullName) | % { $_ -replace 'AssemblyVersion(\"[0-9]+(.([0-9]+|*)){1,3}\")', \"AssemblyVersion(\"\"$assemblyVersion\"\")\" }| sc $_.FullName\r\n(gc $_.FullName) | % { $_ -replace 'AssemblyFileVersion(\"[0-9]+(.([0-9]+|*)){1,3}\")', \"AssemblyFileVersion(\"\"$fileAssemblyVersion\"\")\" }| sc $_.FullName\r\nWrite-Host \"Done!\"\r\nWrite-Host $assemblyVersion\r\nWrite-Host $fileAssemblyVersion\r\nWrite-Host $extractedBuildNum\r\n\r\n}\r\n}\r\ncatch {\r\nWrite-Host $_\r\nexit 1\r\n}<\/pre>\n<p>I opened the process template and within &#8220;<strong>Try Compile\u00a0and Test&#8221;<\/strong> I added <strong>If<\/strong> sequence activity\u00a0<a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/in-try-and-compile-i-add-if-squence\/#main\" rel=\"attachment wp-att-4841\"><br \/>\n<img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-4841\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/in-try-and-compile-i-add-if-squence.png\" alt=\"In Try and Compile I add if squence\" width=\"563\" height=\"526\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/in-try-and-compile-i-add-if-squence.png 563w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/in-try-and-compile-i-add-if-squence-300x280.png 300w\" sizes=\"(max-width: 563px) 100vw, 563px\" \/><\/a><\/p>\n<p>The main activity inside the &#8220;If&#8221; activity will be <strong>InvokeProcess<\/strong> as the following:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/versionassembly-invokeprocess\/#main\" rel=\"attachment wp-att-4840\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4840\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/versionassembly-invokeprocess.png?w=660\" alt=\"VersionAssembly InvokeProcess\" width=\"660\" height=\"355\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/versionassembly-invokeprocess.png 1015w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/versionassembly-invokeprocess-300x161.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/versionassembly-invokeprocess-768x413.png 768w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>I sent argument to the PowerShell script as the following:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/argument-for-powershell\/#main\" rel=\"attachment wp-att-4842\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4842\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/argument-for-powershell.png?w=660\" alt=\"Argument for PowerShell\" width=\"660\" height=\"146\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/argument-for-powershell.png 834w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/argument-for-powershell-300x67.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/argument-for-powershell-768x170.png 768w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>To set parameters in the build definition, see the following image:<br \/>\n<a href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/dev_build_version-2\/#main\" rel=\"attachment wp-att-4847\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-4847\" src=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/dev_build_version1.png?w=660\" alt=\"Dev_Build_Version\" width=\"660\" height=\"189\" srcset=\"https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/dev_build_version1.png 1682w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/dev_build_version1-300x86.png 300w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/dev_build_version1-768x220.png 768w, https:\/\/mohamedradwan.com\/wp-content\/uploads\/2015\/01\/dev_build_version1-1024x293.png 1024w\" sizes=\"(max-width: 660px) 100vw, 660px\" \/><\/a><\/p>\n<p>Remember if you want to not change the Version number, remove B.R and Add 0.0 instead ex (2.5.0.0)<\/p>\n<p><a title=\"Download the Process Template\" href=\"https:\/\/onedrive.live.com\/redir?resid=4BCAA16D27B46600!22426&amp;authkey=!AAwD26mHv7T1OrQ&amp;ithint=file%2czip\" target=\"_blank\">Download the Process Template<\/a><\/p>\n<p><a href=\"https:\/\/onedrive.live.com\/redir?resid=4BCAA16D27B46600!22429&amp;authkey=!AHGC6cOE0h3eQLc&amp;ithint=file%2czip\" target=\"_blank\">Download PowerShell Script<\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>My fellows MVPs\u00a0Colin Dembovsky and Ricci Gian Maria had great &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2015\/01\/27\/versioning-assembly-during-tfs-build-2013\/\"> <span class=\"screen-reader-text\">Versioning Assembly during TFS Build 2013<\/span> Read More<\/a><\/p>\n","protected":false},"author":1,"featured_media":5507,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,17,28,43],"tags":[444],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4829"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=4829"}],"version-history":[{"count":3,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4829\/revisions"}],"predecessor-version":[{"id":8993,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/4829\/revisions\/8993"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media\/5507"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=4829"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=4829"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=4829"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}