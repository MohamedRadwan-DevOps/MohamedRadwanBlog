{"id":589,"date":"2010-10-09T00:10:06","date_gmt":"2010-10-09T00:10:06","guid":{"rendered":"https:\/\/mohamedradwan.com\/?p=219"},"modified":"2010-10-09T00:10:06","modified_gmt":"2010-10-09T00:10:06","slug":"execute-and-run-sql-script-from-c","status":"publish","type":"post","link":"https:\/\/mohamedradwan.com\/2010\/10\/09\/execute-and-run-sql-script-from-c\/","title":{"rendered":"Execute and Run SQL script from C#"},"content":{"rendered":"<hr\/>\n<p>I work in a project that used an integration testing that need to check for a specific data in the DB so as the best practice I just want to insert my test data into the DB and then run my test and at the end of the test remove this data to restate the DB to the original state so I search for a way to execute SQL script or run SQL script quickly and efficiency that may need DDL and DML so I use the following code<br \/>\n[sourcecode language=&#8221;csharp&#8221;]<br \/>\nusing System.Data.SqlClient;<br \/>\nusing System.IO;<br \/>\nusing Microsoft.SqlServer.Management.Common;<br \/>\nusing Microsoft.SqlServer.Management.Smo;<\/p>\n<p>namespace ConsoleApplication1<br \/>\n{<br \/>\n    class Program<br \/>\n    {<br \/>\n        static void Main(string[] args)<br \/>\n        {<br \/>\n            string connectionString = &quot;Data Source=.;Initial<br \/>\n            Catalog=MyDB;Integrated Security=True&quot;;<br \/>\n            FileInfo file = new FileInfo(&quot;D:\\myscript.sql&quot;);<br \/>\n            string script = file.OpenText().ReadToEnd();<br \/>\n            SqlConnection sqlConnection = new<br \/>\n            SqlConnection(connectionString);<br \/>\n            Server server = new Server(new ServerConnection(sqlConnection ));<br \/>\n            server.ConnectionContext.ExecuteNonQuery(script);<br \/>\n        }<br \/>\n    }<br \/>\n}<br \/>\n[\/sourcecode]<\/p>\n<p>Note you have to reference the following DLLs  Microsoft.SqlServer.ConnectionInfo and Microsoft.SqlServer.Management.Sdk.Sfc<br \/>\nMy first problem was where is the Microsoft.SqlServer.Management.Smo? and where is the Microsoft.SqlServer.Management.Common? you will find them &#8220;C:Program Files (x86)Microsoft SQL Server100SDKAssemblies&#8221; and if you can&#8217;t find them you can go to the following link so you can download them and it&#8217;s related DLLs <a href=\"http:\/\/www.microsoft.com\/downloads\/en\/details.aspx?FamilyId=C6C3E9EF-BA29-4A43-8D69-A2BED18FE73C&amp;displaylang=en\">click here<\/a><\/p>\n<p>The second problem was that I have the following error<br \/>\n&#8220;Mixed mode assembly is built against version &#8216;v2.0.50727&#8217; of the runtime<br \/>\nand cannot be loaded in the 4.0 runtime without additional<br \/>\nconfiguration information&#8221;<\/p>\n<p>so you have to add the following underline text in the app.config so it will look like the following<\/p>\n<p>[sourcecode language=&#8221;csharp&#8221;]<br \/>\n&lt;?xml version=&quot;1.0&quot;?&gt;<br \/>\n&lt;configuration&gt;<\/p>\n<p>  &lt;startup&gt;&lt;supportedRuntime version=&quot;v4.0&quot; sku=&quot;.NETFramework,Version=v4.0&quot;\/&gt;&lt;\/startup&gt;<\/p>\n<p>  &lt;startup useLegacyV2RuntimeActivationPolicy=&quot;true&quot;&gt;<br \/>\n    &lt;supportedRuntime version=&quot;v4.0&quot; sku=&quot;.NETFramework,Version=v4.0&quot;\/&gt;<br \/>\n &lt;\/startup&gt;<\/p>\n<p>&lt;\/configuration&gt;<br \/>\n[\/sourcecode]<\/p>\n<p>That&#8217;s it<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I work in a project that used an integration testing &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"ast-button\" href=\"https:\/\/mohamedradwan.com\/2010\/10\/09\/execute-and-run-sql-script-from-c\/\"> <span class=\"screen-reader-text\">Execute and Run SQL script from C#<\/span> Read More<\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[16,20],"tags":[],"_links":{"self":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/589"}],"collection":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/comments?post=589"}],"version-history":[{"count":0,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/posts\/589\/revisions"}],"wp:attachment":[{"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/media?parent=589"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/categories?post=589"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mohamedradwan.com\/wp-json\/wp\/v2\/tags?post=589"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}